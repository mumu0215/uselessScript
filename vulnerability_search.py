import json
import requests
import argparse

# wiki: https://developer.shodan.io/api/exploit-specification
# usage：python vulnerability_search.py -k mysql -d

def search(api, argv):
    url = "https://exploits.shodan.io/api/search?key=%s&query=%s" % (api, argv.keyword)
    results = json.loads(requests.get(url).text)["matches"]
    total = len(results)
    for i in range(total):
        data = results[i]
        detail = data["description"] if argv.detail else ""
        print("%s-%s\t%s" % (data["source"], str(data["_id"]), detail))
    print("\n%d results." % total)

def main():
    # 不充钱最多只能搜100个结果
    apikey = "4LV6gDwPXJZOkFXx86L8QCcyuV1B3zKx"
    parser = argparse.ArgumentParser()
    parser.add_argument("-k", "--keyword", help="Keywords of vulnerability.", type=str, required=True)
    parser.add_argument("-d", "--detail", help="A description explaining the details of the exploit.", action="store_true")
    args = parser.parse_args()
    search(apikey, args)

if __name__ == "__main__":
    main()